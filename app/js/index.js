//check the correct connection with web3
if (typeof web3 !== 'undefined') {
    web3 = new Web3(web3.currentProvider);
} else {
    // set the provider you want from Web3.providers
    web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
}

//print the currnet accounts in the network
var accounts = web3.eth.accounts;
console.log(accounts);

//create a new useraccount contract and use it
var ID = "thisismyid";
var PubKey = "thisismypublickey";
var UserAccount = web3.eth.contract([{
    "constant": false,
    "inputs": [{"name": "CAddress", "type": "address"}],
    "name": "deleteContact",
    "outputs": [{"name": "isSuccessful", "type": "bool"}],
    "payable": false,
    "type": "function"
}, {
    "constant": false,
    "inputs": [{"name": "CName", "type": "string"}, {"name": "CPubkey", "type": "string"}, {
        "name": "CAddress",
        "type": "address"
    }],
    "name": "AddContact",
    "outputs": [],
    "payable": false,
    "type": "function"
}, {
    "constant": false,
    "inputs": [],
    "name": "getPublicKey",
    "outputs": [{"name": "myPublickey", "type": "string"}],
    "payable": false,
    "type": "function"
}, {
    "constant": false,
    "inputs": [],
    "name": "getUserID",
    "outputs": [{"name": "ID", "type": "string"}],
    "payable": false,
    "type": "function"
}, {
    "constant": false,
    "inputs": [],
    "name": "getAddress",
    "outputs": [{"name": "myAddress", "type": "address"}],
    "payable": false,
    "type": "function"
}, {
    "constant": true,
    "inputs": [],
    "name": "MyAddress",
    "outputs": [{"name": "", "type": "address"}],
    "payable": false,
    "type": "function"
}, {
    "constant": false,
    "inputs": [{"name": "CAddress", "type": "address"}, {"name": "CPubkey", "type": "string"}],
    "name": "AlterContactPubkey",
    "outputs": [{"name": "isSuccessful", "type": "bool"}],
    "payable": false,
    "type": "function"
}, {
    "constant": false,
    "inputs": [{"name": "newPubKey", "type": "string"}],
    "name": "setPublicKey",
    "outputs": [],
    "payable": false,
    "type": "function"
}, {
    "constant": true,
    "inputs": [],
    "name": "MyPubKey",
    "outputs": [{"name": "", "type": "string"}],
    "payable": false,
    "type": "function"
}, {
    "constant": false,
    "inputs": [{"name": "AName", "type": "string"}, {"name": "AUsername", "type": "string"}],
    "name": "getSocialAccount",
    "outputs": [{"name": "Name", "type": "string"}, {"name": "Username", "type": "string"}, {
        "name": "Password",
        "type": "string"
    }, {"name": "isFound", "type": "bool"}],
    "payable": false,
    "type": "function"
}, {
    "constant": false,
    "inputs": [{"name": "CAddress", "type": "address"}, {"name": "CName", "type": "string"}],
    "name": "AlterContactName",
    "outputs": [{"name": "isSuccessful", "type": "bool"}],
    "payable": false,
    "type": "function"
}, {
    "constant": false,
    "inputs": [{"name": "Name", "type": "string"}, {"name": "Username", "type": "string"}, {
        "name": "NewPassword",
        "type": "string"
    }],
    "name": "AlterSocialAccountPassword",
    "outputs": [{"name": "isSuccessful", "type": "bool"}],
    "payable": false,
    "type": "function"
}, {
    "constant": false,
    "inputs": [{"name": "Name", "type": "string"}, {"name": "Username", "type": "string"}],
    "name": "deleteSocialAccount",
    "outputs": [{"name": "isSuccessful", "type": "bool"}],
    "payable": false,
    "type": "function"
}, {
    "constant": false,
    "inputs": [{"name": "Name", "type": "string"}, {"name": "Username", "type": "string"}, {
        "name": "Password",
        "type": "string"
    }],
    "name": "AddSocialAccount",
    "outputs": [],
    "payable": false,
    "type": "function"
}, {
    "constant": false,
    "inputs": [{"name": "CAddress", "type": "address"}],
    "name": "getContact",
    "outputs": [{"name": "CName", "type": "string"}, {"name": "CPubKey", "type": "string"}, {
        "name": "ConAddress",
        "type": "address"
    }, {"name": "isFound", "type": "bool"}],
    "payable": false,
    "type": "function"
}, {
    "inputs": [{"name": "ID", "type": "string"}, {"name": "PubKey", "type": "string"}],
    "payable": false,
    "type": "constructor"
}]);
var UserAccountOne = UserAccount.new(
    ID,
    PubKey,
    {
        from: web3.eth.accounts[0],
        data: '0x606060405234156200000d57fe5b604051620024b2380380620024b2833981016040528080518201919060200180518201919050505b81600090805190602001906200004d929190620000b1565b50806001908051906020019062000066929190620000b1565b5033600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b505062000160565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10620000f457805160ff191683800117855562000125565b8280016001018555821562000125579182015b828111156200012457825182559160200191906001019062000107565b5b50905062000134919062000138565b5090565b6200015d91905b80821115620001595760008160009055506001016200013f565b5090565b90565b61234280620001706000396000f300606060405236156100d9576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680631046bc68146100db5780631e1ba1ec146101295780632e334452146101e55780632eeb6d7f1461027e57806338cc48311461031757806343a78b50146103695780635725f4a1146103bb5780636f6fc0771461044c57806385160570146104a65780638e6834eb1461053f5780639ab3bf61146107625780639d233f6a146107f3578063b2fb9f59146108eb578063bf87b974146109a0578063f96a181e14610a80575bfe5b34156100e357fe5b61010f600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610bf5565b604051808215151515815260200191505060405180910390f35b341561013157fe5b6101e3600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610cfe565b005b34156101ed57fe5b6101f5610e8e565b6040518080602001828103825283818151815260200191508051906020019080838360008314610244575b80518252602083111561024457602082019150602081019050602083039250610220565b505050905090810190601f1680156102705780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561028657fe5b61028e610f37565b60405180806020018281038252838181518152602001915080519060200190808383600083146102dd575b8051825260208311156102dd576020820191506020810190506020830392506102b9565b505050905090810190601f1680156103095780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561031f57fe5b610327610fe0565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561037157fe5b61037961100b565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156103c357fe5b610432600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050611031565b604051808215151515815260200191505060405180910390f35b341561045457fe5b6104a4600480803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919050506110f4565b005b34156104ae57fe5b6104b661110f565b6040518080602001828103825283818151815260200191508051906020019080838360008314610505575b805182526020831115610505576020820191506020810190506020830392506104e1565b505050905090810190601f1680156105315780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561054757fe5b6105da600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919050506111ad565b604051808060200180602001806020018515151515815260200184810384528881815181526020019150805190602001908083836000831461063b575b80518252602083111561063b57602082019150602081019050602083039250610617565b505050905090810190601f1680156106675780820380516001836020036101000a031916815260200191505b508481038352878181518152602001915080519060200190808383600083146106af575b8051825260208311156106af5760208201915060208101905060208303925061068b565b505050905090810190601f1680156106db5780820380516001836020036101000a031916815260200191505b50848103825286818151815260200191508051906020019080838360008314610723575b805182526020831115610723576020820191506020810190506020830392506106ff565b505050905090810190601f16801561074f5780820380516001836020036101000a031916815260200191505b5097505050505050505060405180910390f35b341561076a57fe5b6107d9600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190505061170f565b604051808215151515815260200191505060405180910390f35b34156107fb57fe5b6108d1600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919050506117d2565b604051808215151515815260200191505060405180910390f35b34156108f357fe5b610986600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919050506119b8565b604051808215151515815260200191505060405180910390f35b34156109a857fe5b610a7e600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050611bcd565b005b3415610a8857fe5b610ab4600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050611f77565b6040518080602001806020018573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200184151515158152602001838103835287818151815260200191508051906020019080838360008314610b43575b805182526020831115610b4357602082019150602081019050602083039250610b1f565b505050905090810190601f168015610b6f5780820380516001836020036101000a031916815260200191505b50838103825286818151815260200191508051906020019080838360008314610bb7575b805182526020831115610bb757602082019150602081019050602083039250610b93565b505050905090810190601f168015610be35780820380516001836020036101000a031916815260200191505b50965050505050505060405180910390f35b6000600460008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160149054906101000a900460ff1615610cf357600460008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000600082016000610c9d9190612215565b600182016000610cad9190612215565b6002820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690556002820160146101000a81549060ff0219169055505060019050610cf8565b600090505b5b919050565b82600460008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000019080519060200190610d5492919061225d565b5081600460008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206001019080519060200190610dab92919061225d565b5080600460008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506001600460008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160146101000a81548160ff0219169083151502179055505b505050565b610e966122dd565b60018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610f2c5780601f10610f0157610100808354040283529160200191610f2c565b820191906000526020600020905b815481529060010190602001808311610f0f57829003601f168201915b505050505090505b90565b610f3f6122dd565b60008054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610fd55780601f10610faa57610100808354040283529160200191610fd5565b820191906000526020600020905b815481529060010190602001808311610fb857829003601f168201915b505050505090505b90565b6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505b90565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000600460008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160149054906101000a900460ff16156110e85781600460008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010190805190602001906110de92919061225d565b50600190506110ed565b600090505b5b92915050565b806001908051906020019061110a92919061225d565b505b50565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156111a55780601f1061117a576101008083540402835291602001916111a5565b820191906000526020600020905b81548152906001019060200180831161118857829003601f168201915b505050505081565b6111b56122dd565b6111bd6122dd565b6111c56122dd565b60006003866040518082805190602001908083835b602083106111fd57805182526020820191506020810190506020830392506111da565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020856040518082805190602001908083835b602083106112645780518252602082019150602081019050602083039250611241565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060030160009054906101000a900460ff1615611700576003866040518082805190602001908083835b602083106112e357805182526020820191506020810190506020830392506112c0565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020856040518082805190602001908083835b6020831061134a5780518252602082019150602081019050602083039250611327565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206000018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156114145780601f106113e957610100808354040283529160200191611414565b820191906000526020600020905b8154815290600101906020018083116113f757829003601f168201915b505050505093506003866040518082805190602001908083835b60208310611451578051825260208201915060208101905060208303925061142e565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020856040518082805190602001908083835b602083106114b85780518252602082019150602081019050602083039250611495565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206001018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156115825780601f1061155757610100808354040283529160200191611582565b820191906000526020600020905b81548152906001019060200180831161156557829003601f168201915b505050505092506003866040518082805190602001908083835b602083106115bf578051825260208201915060208101905060208303925061159c565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020856040518082805190602001908083835b602083106116265780518252602082019150602081019050602083039250611603565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206002018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156116f05780601f106116c5576101008083540402835291602001916116f0565b820191906000526020600020905b8154815290600101906020018083116116d357829003601f168201915b5050505050915060019050611705565b600090505b5b92959194509250565b6000600460008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160149054906101000a900460ff16156117c65781600460008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000190805190602001906117bc92919061225d565b50600190506117cb565b600090505b5b92915050565b60006003846040518082805190602001908083835b6020831061180a57805182526020820191506020810190506020830392506117e7565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020836040518082805190602001908083835b60208310611871578051825260208201915060208101905060208303925061184e565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060030160009054906101000a900460ff16156119ab57816003856040518082805190602001908083835b602083106118f157805182526020820191506020810190506020830392506118ce565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020846040518082805190602001908083835b602083106119585780518252602082019150602081019050602083039250611935565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060020190805190602001906119a192919061225d565b50600190506119b0565b600090505b5b9392505050565b60006003836040518082805190602001908083835b602083106119f057805182526020820191506020810190506020830392506119cd565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020826040518082805190602001908083835b60208310611a575780518252602082019150602081019050602083039250611a34565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060030160009054906101000a900460ff1615611bc1576003836040518082805190602001908083835b60208310611ad65780518252602082019150602081019050602083039250611ab3565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020826040518082805190602001908083835b60208310611b3d5780518252602082019150602081019050602083039250611b1a565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206000600082016000611b829190612215565b600182016000611b929190612215565b600282016000611ba29190612215565b6003820160006101000a81549060ff0219169055505060019050611bc6565b600090505b5b92915050565b826003846040518082805190602001908083835b60208310611c045780518252602082019150602081019050602083039250611be1565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020836040518082805190602001908083835b60208310611c6b5780518252602082019150602081019050602083039250611c48565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206000019080519060200190611cb492919061225d565b50816003846040518082805190602001908083835b60208310611cec5780518252602082019150602081019050602083039250611cc9565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020836040518082805190602001908083835b60208310611d535780518252602082019150602081019050602083039250611d30565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206001019080519060200190611d9c92919061225d565b50806003846040518082805190602001908083835b60208310611dd45780518252602082019150602081019050602083039250611db1565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020836040518082805190602001908083835b60208310611e3b5780518252602082019150602081019050602083039250611e18565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206002019080519060200190611e8492919061225d565b5060016003846040518082805190602001908083835b60208310611ebd5780518252602082019150602081019050602083039250611e9a565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020836040518082805190602001908083835b60208310611f245780518252602082019150602081019050602083039250611f01565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060030160006101000a81548160ff0219169083151502179055505b505050565b611f7f6122dd565b611f876122dd565b60006000600460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160149054906101000a900460ff161561220857600460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156120b65780601f1061208b576101008083540402835291602001916120b6565b820191906000526020600020905b81548152906001019060200180831161209957829003601f168201915b50505050509350600460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206001018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156121935780601f1061216857610100808354040283529160200191612193565b820191906000526020600020905b81548152906001019060200180831161217657829003601f168201915b50505050509250600460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1691506001905061220d565b600090505b5b9193509193565b50805460018160011615610100020316600290046000825580601f1061223b575061225a565b601f01602090049060005260206000209081019061225991906122f1565b5b50565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061229e57805160ff19168380011785556122cc565b828001600101855582156122cc579182015b828111156122cb5782518255916020019190600101906122b0565b5b5090506122d991906122f1565b5090565b602060405190810160405280600081525090565b61231391905b8082111561230f5760008160009055506001016122f7565b5090565b905600a165627a7a723058206761d14f4dc6305394878d38edeadf5607cde698bb274facfab7a8dbd6cd44a00029',
        gas: '4700000'
    }, function (e, contract) {
        console.log(e, contract);
        if (typeof contract.address !== 'undefined') {
            console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
        }
    });


//add log to the bottom of the page.It if for testing
var addToLog = function (id, txt) {
    $(id + " .logs").append("<br>" + txt);
};


// ===========================
// Blockchain example
// ===========================
$(document).ready(function () {
    $("#blockchain button.set").click(function () {
        var value = $("#blockchain input.text").val();
        UserAccount.setPublicKey(value);
        addToLog("#blockchain", "UserAccount.setPublicKey(" + value + ")");
    });

    $("#blockchain button.get").click(function () {
        var testaddress = UserAccountOne.getAddress();
        console.log(testaddress);
        $("#blockchain .value").html(testaddress);
        addToLog("#blockchain", testaddress);
    });

});


